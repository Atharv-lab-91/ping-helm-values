global:
  ingress:
    enabled: true
  license:
    secret:
      devOps: devops-secret

pingfederate-admin:
  enabled: true

  image:
    name: pingfederate
    tag: "latest"
    pullPolicy: IfNotPresent

  secretVolumes:
    pingfederate-license:
      items:
        pingfederate.lic: /opt/in/instance/server/default/conf/pingfederate.lic

  container:
    resources:
      requests:
        cpu: 0
        memory: 2Gi
      limits:
        cpu: 2
        memory: 6Gi

    # Startup probe: wait longer for PingFederate to initialize
    startupProbe:
      exec:
        command: ["/opt/liveness.sh"]
      initialDelaySeconds: 120   # wait 2 minutes before first check
      periodSeconds: 10
      failureThreshold: 30       # allow ~5 minutes for startup

  envs:
    SERVER_PROFILE_URL: "https://github.com/Atharv-lab-91/ping-server-profile.git"
    SERVER_PROFILE_PATH: "baseline/pingfederate"
    SERVER_PROFILE_BRANCH: "main"
    PING_IDENTITY_ACCEPT_EULA: "YES"
    PF_ADMIN_PUBLIC_HOSTNAME: "localhost:9999"
    PF_ADMIN_PUBLIC_BASEURL: "https://localhost:9999"

  # Explicitly inject all passwords from the Kubernetes secret
  env:
    - name: PING_IDENTITY_PASSWORD
      valueFrom:
        secretKeyRef:
          name: ping-admin-secrets
          key: PING_IDENTITY_PASSWORD
    - name: administrativeAccounts_items_Administrator_password
      valueFrom:
        secretKeyRef:
          name: ping-admin-secrets
          key: PING_IDENTITY_PASSWORD
    - name: passwordCredentialValidators_items_simple_configuration_tables_rows_fields_Confirm_Password_value
      valueFrom:
        secretKeyRef:
          name: ping-admin-secrets
          key: passwordCredentialValidators_items_simple_configuration_tables_rows_fields_Confirm_Password_value
    - name: PRIVATE_KEYSTORE_PIN
      valueFrom:
        secretKeyRef:
          name: ping-admin-secrets
          key: PRIVATE_KEYSTORE_PIN
    - name: keyPairs_signing_items_devsigningcert_devsigningcert_password
      valueFrom:
        secretKeyRef:
          name: ping-admin-secrets
          key: keyPairs_signing_items_devsigningcert_devsigningcert_password
    - name: passwordCredentialValidators_items_simple_configuration_tables_rows_fields_Password_value
      valueFrom:
        secretKeyRef:
          name: ping-admin-secrets
          key: passwordCredentialValidators_items_simple_configuration_tables_rows_fields_Password_value

  workload:
    type: Deployment

  services:
    https:
      enabled: true
      serviceType: NodePort
      servicePort: 9999
      containerPort: 9999
      nodePort: 30099
      dataService: true
